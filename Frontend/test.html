<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple Supabase Test</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 40px 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 { color: #333; margin-bottom: 30px; }
    button {
      padding: 12px 24px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    button:hover { background: #5568d3; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    .result {
      margin-top: 20px;
      padding: 20px;
      border-radius: 8px;
      background: #f8f9fa;
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 13px;
      line-height: 1.6;
      display: none;
    }
    .result.show { display: block; }
    .success { background: #d4edda; color: #155724; border: 2px solid #28a745; }
    .error { background: #f8d7da; color: #721c24; border: 2px solid #dc3545; }
    .info { background: #d1ecf1; color: #0c5460; border: 2px solid #17a2b8; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß™ Simple Supabase Test</h1>
    
    <button onclick="testConnection()">1. Test Connection</button>
    <button onclick="checkTables()">2. Check Tables</button>
    <button onclick="checkStorage()">3. Check Storage</button>
    <button onclick="testInsert()">4. Test Insert</button>
    <button onclick="viewProducts()">5. View All Products</button>
    
    <div id="result" class="result"></div>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

    // PASTE YOUR CREDENTIALS HERE
    const SUPABASE_URL = 'https://fqyvitdzkvflxtnhxqag.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZxeXZpdGR6a3ZmbHh0bmh4cWFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2ODYyNDQsImV4cCI6MjA3NTI2MjI0NH0.4viyUhVY_IQKqmeV0BL28BTGWL2hIJg13yGYUmvoPBU';

    window.supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
    const result = document.getElementById('result');

    function showResult(text, type = 'info') {
      result.className = `result show ${type}`;
      result.textContent = text;
    }

    window.testConnection = async function() {
      showResult('Testing connection...', 'info');
      try {
        const { data, error } = await supabase
          .from('products')
          .select('count');
        
        if (error) {
          showResult(`‚ùå Error: ${error.message}\n\nThis might mean the products table doesn't exist yet.\nRun the SQL setup in Supabase!`, 'error');
        } else {
          showResult('‚úÖ Connection successful!\n\nSupabase is working correctly.', 'success');
        }
      } catch (err) {
        showResult(`‚ùå Failed: ${err.message}`, 'error');
      }
    };

    window.checkTables = async function() {
      showResult('Checking tables...', 'info');
      const tables = ['products', 'votes', 'comments'];
      const results = [];
      
      for (const table of tables) {
        try {
          const { error } = await supabase.from(table).select('count').limit(1);
          if (error) {
            results.push(`‚ùå ${table}: NOT FOUND (${error.message})`);
          } else {
            results.push(`‚úÖ ${table}: EXISTS`);
          }
        } catch (err) {
          results.push(`‚ùå ${table}: ERROR - ${err.message}`);
        }
      }
      
      showResult(results.join('\n\n'), results.every(r => r.includes('‚úÖ')) ? 'success' : 'error');
    };

    window.checkStorage = async function() {
      showResult('Checking storage...', 'info');
      try {
        const { data, error } = await supabase.storage.listBuckets();
        
        if (error) {
          showResult(`‚ùå Storage Error: ${error.message}`, 'error');
          return;
        }
        
        const bucket = data.find(b => b.name === 'product-images');
        if (bucket) {
          showResult(`‚úÖ Storage bucket 'product-images' found!\n\nBucket ID: ${bucket.id}\nPublic: ${bucket.public}\nCreated: ${bucket.created_at}`, 'success');
        } else {
          showResult(`‚ùå Bucket 'product-images' not found.\n\nAvailable buckets:\n${data.map(b => `- ${b.name}`).join('\n') || 'None'}`, 'error');
        }
      } catch (err) {
        showResult(`‚ùå Failed: ${err.message}`, 'error');
      }
    };

    window.testInsert = async function() {
      showResult('Testing insert...', 'info');
      const testProduct = {
        name: 'Test Product',
        tagline: 'Testing Supabase setup',
        url: 'https://example.com',
        description: 'This is a test product to verify the database is working.',
        category: 'Other',
        founders: 'Test User',
        user_id: 'test-' + Date.now(),
        tags: ['test', 'demo']
      };
      
      try {
        const { data, error } = await supabase
          .from('products')
          .insert([testProduct])
          .select();
        
        if (error) {
          showResult(`‚ùå Insert Failed: ${error.message}\n\nDetails: ${error.hint || 'No additional info'}`, 'error');
        } else {
          showResult(`‚úÖ Insert Successful!\n\nProduct created with ID: ${data[0].id}\n\nNow cleaning up test data...`, 'success');
          
          // Clean up
          setTimeout(async () => {
            await supabase.from('products').delete().eq('id', data[0].id);
            showResult(`‚úÖ Insert test passed!\n\nTest product was created and then deleted.\nYour database is working perfectly!`, 'success');
          }, 2000);
        }
      } catch (err) {
        showResult(`‚ùå Failed: ${err.message}`, 'error');
      }
    };

    window.viewProducts = async function() {
      showResult('Loading products...', 'info');
      try {
        const { data, error } = await supabase
          .from('products')
          .select('*')
          .order('created_at', { ascending: false })
          .limit(10);
        
        if (error) {
          showResult(`‚ùå Error: ${error.message}`, 'error');
        } else if (data.length === 0) {
          showResult('üì≠ No products found yet.\n\nSubmit your first product to see it here!', 'info');
        } else {
          const list = data.map((p, i) => 
            `${i + 1}. ${p.name}\n   ${p.tagline}\n   Votes: ${p.votes} | Status: ${p.status}\n   Created: ${new Date(p.created_at).toLocaleString()}`
          ).join('\n\n');
          showResult(`‚úÖ Found ${data.length} products:\n\n${list}`, 'success');
        }
      } catch (err) {
        showResult(`‚ùå Failed: ${err.message}`, 'error');
      }
    };

    // Auto-test on load
    setTimeout(() => {
      if (SUPABASE_URL.includes('your-project')) {
        showResult('‚ö†Ô∏è Please update SUPABASE_URL and SUPABASE_KEY in the script!\n\nLook for this section in the HTML code and paste your credentials.', 'error');
      } else {
        testConnection();
      }
    }, 500);
  </script>
</body>
</html>